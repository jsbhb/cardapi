<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fireCloud.tradCity.member.mapper.MemberMapper">

	<resultMap type="com.fireCloud.tradCity.member.model.submodel.SimpleMemberInfoModel" id="simpleMemberInfo">
		<id column="memberId" property="memberId" jdbcType="INTEGER" />
		<result column="memberName" property="memberName" jdbcType="VARCHAR" />
		<result column="product" property="product" jdbcType="VARCHAR" />
		<result column="reputation" property="reputation" jdbcType="INTEGER" />
		<result column="logoPath" property="logoPath" jdbcType="VARCHAR" />
		<result column="frontPicPath" property="frontPicPath" jdbcType="VARCHAR" />
		<result column="guarantee" property="guarantee" jdbcType="INTEGER" />
		<result column="highQuality" property="highQuality" jdbcType="INTEGER" />
		<result column="sincerity" property="sincerity" jdbcType="INTEGER" />
		<result column="returnGoods" property="returnGoods" jdbcType="INTEGER" />
		<result column="province" property="province" jdbcType="VARCHAR" />
		<result column="city" property="city" jdbcType="VARCHAR" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="popularize" property="popularize" jdbcType="INTEGER" />
		<collection property="memberClassify" ofType = "com.fireCloud.tradCity.member.model.MemberClassifyModel">
			<id column="id" property="id" jdbcType="INTEGER" />
			<result column="industry" property="industry" jdbcType="VARCHAR" />
			<result column="category" property="category" jdbcType="VARCHAR" />
			<result column="industryName" property="industryName" jdbcType="VARCHAR" />
			<result column="categoryName" property="categoryName" jdbcType="VARCHAR" />
		</collection>
	</resultMap>

	<select id="querySimpleMember" resultMap="simpleMemberInfo"
		parameterType="java.util.Map">
		select m.id as memberId,mc.id,m.memberName,m.product,m.reputation,m.logoPath,m.frontPicPath,m.guarantee,m.highQuality,
		m.sincerity,m.returnGoods,m.province,m.city,m.area,m.address,m.popularize,mc.industry,mc.category,mc.industryName,mc.categoryName 
		from member m left join member_category mc on m.id = mc.memberId where 1=1
		<if test="member != null">
			<if test="member.memberName != null and member.memberName != ''">
				and m.memberName like concat('%',#{member.memberName,jdbcType=VARCHAR},'%')
			</if>
			<if test="member.memberClassify != null and member.memberClassify.size > 0">
				and mc.industry in
				<foreach collection="member.memberClassify" item="item" open="("
					separator="," close=")">
					<if test="item.industry != null and item.industry != ''">
						#{item.industry}
					</if>
				</foreach>
				and mc.category in 
				<foreach collection="member.memberClassify" item="item" open="("
					separator="," close=")">
					<if test="item.category != null and item.category != ''">
						#{item.category}
					</if>
				</foreach>
			</if>
			<if test="member.guarantee != null and member.guarantee != ''">
				and m.guarantee = #{member.guarantee}
			</if>
			<if test="member.highQuality != null and member.highQuality != ''">
				and m.highQuality = #{member.highQuality}
			</if>
			<if test="member.sincerity != null and member.sincerity != ''">
				and m.sincerity = #{member.sincerity}
			</if>
			<if test="member.returnGoods != null and member.returnGoods != ''">
				and m.returnGoods = #{member.returnGoods}
			</if>
			<if test="member.province != null and member.province != ''">
				and m.province = #{member.province}
			</if>
			<if test="member.city != null and member.city != ''">
				and m.city = #{member.city}
			</if>
			<if test="member.area != null and member.area != ''">
				and m.area = #{member.area}
			</if>
		</if>
		order by
		<if test="sortList != null and sortList.size > 0">
			<foreach collection="sortList" item="sort" open=""
					separator="" close="">
					${sort.sortField} ${sort.sortRule},
			</foreach>
		</if>
		popularize desc 
	</select>
</mapper>